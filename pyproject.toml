# pyproject.toml

[tool.ruff]
# âœ… Set line-length cho formatter vÃ  linter
line-length = 88  # TÆ°Æ¡ng thÃ­ch vá»›i Black, trÃ¡nh conflict vá»›i VS Code formatter
# Target Python version - cáº­p nháº­t theo dá»± Ã¡n
target-version = "py311"
# Include/exclude patterns
include = ["*.py", "*.pyi", "**/pyproject.toml"]
exclude = [
    ".bzr",
    ".direnv",
    ".eggs",
    ".git",
    ".git-rewrite",
    ".hg",
    ".mypy_cache",
    ".nox",
    ".pants.d",
    ".pytype",
    ".ruff_cache",
    ".svn",
    ".tox",
    ".venv",
    "__pypackages__",
    "_build",
    "buck-out",
    "build",
    "dist",
    "node_modules",
    "venv",
    "migrations",  # Django migrations
    "*_pb2.py",    # Protocol buffers
]

[tool.ruff.lint]
# Chá»n cÃ¡c bá»™ quy táº¯c linter Ä‘á»ƒ kÃ­ch hoáº¡t.
# E, W: Lá»—i vÃ  cáº£nh bÃ¡o (chuáº©n Pyflakes)
# F: Lá»—i logic (chuáº©n Flake8)
# I: Sáº¯p xáº¿p import (chuáº©n isort)
# B: Lá»—i bug (flake8-bugbear)
# C4: Lá»—i phá»©c táº¡p khÃ´ng cáº§n thiáº¿t (flake8-comprehensions)
# A: Cáº£nh bÃ¡o vá» built-in shadowing (flake8-builtins)
select = ["E", "W", "F", "I", "B", "C4", "A"]

# âœ… Ignore E501 Ä‘á»ƒ trÃ¡nh conflict vá»›i VS Code Ruff formatter
ignore = [
    # Formatting conflicts (handled by formatter)
    "E501",    # Line too long (handled by Ruff formatter)
    "E203",    # Whitespace before ':' (conflicts with Black)

    # Boolean trap - sometimes necessary
    "FBT001",  # Boolean positional arg in function definition
    "FBT002",  # Boolean default value in function definition
    "FBT003",  # Boolean positional value in function call

    # Print statements (allow for demo purposes)
    # "T201",    # `print` found - commented out to allow prints
]

# âœ… Per-file ignores - Ãp dá»¥ng rules khÃ¡c nhau cho tá»«ng loáº¡i file
[tool.ruff.lint.per-file-ignores]
# Tests can use magic values, print statements, etc.
"tests/**/*.py" = [
    "S101",    # asserts allowed in tests
    "ARG",     # Unused function args -> fixtures nevertheless are functionally relevant
    "FBT",     # Don't care about booleans as positional arguments in tests
    "PLR2004", # Magic value used in comparison
    "S311",    # Standard pseudo-random generators are not suitable for security/cryptographic purposes
    "T201",    # Print allowed in tests
]

# Scripts and CLI tools
"scripts/**/*.py" = ["T201", "T203"]  # Allow print/pprint
"cli.py" = ["T201"]

# Django settings
"settings/**/*.py" = ["F403", "F405"]  # Allow star imports in settings

# Migrations
"**/migrations/**/*.py" = ["E501", "F401", "F403", "F405"]

[tool.ruff.lint.isort]
# âœ… Advanced import sorting
combine-as-imports = true
force-sort-within-sections = true
force-wrap-aliases = true
known-local-folder = ["src", "app", "core"]
# Tá»± Ä‘á»™ng thÃªm cÃ¡c thÆ° viá»‡n bÃªn thá»© ba Ä‘Ã£ biáº¿t
known-third-party = [
    # Web frameworks
    "fastapi", "django", "flask", "starlette",
    # Data & DB
    "pydantic", "sqlalchemy", "alembic", "pandas", "numpy",
    # Async
    "asyncio", "aiohttp", "httpx",
    # Testing
    "pytest", "unittest",
    # CLI
    "click", "typer", "argparse",
    # Utilities
    "requests", "python-dotenv", "rich"
]
section-order = [
    "future",
    "standard-library",
    "third-party",
    "first-party",
    "local-folder"
]
split-on-trailing-comma = true

[tool.ruff.lint.mccabe]
# âœ… Complexity threshold - khuyáº¿n nghá»‹ khÃ´ng quÃ¡ 10
max-complexity = 10

[tool.ruff.lint.pylint]
# âœ… Pylint specific settings
max-args = 6  # Maximum number of arguments for function / method
max-branches = 12  # Maximum number of branches for function / method
max-returns = 6   # Maximum number of return / yield for function / method
max-statements = 50  # Maximum number of statements in function / method

[tool.ruff.format]
# âœ… Formatting rules - compatible vá»›i VS Code Ruff extension
quote-style = "single" # DÃ¹ng nhÃ¡y Ä‘Æ¡n thay vÃ¬ nhÃ¡y kÃ©p
indent-style = "space"
skip-magic-trailing-comma = false
line-ending = "auto"
docstring-code-format = true  # Format code in docstrings
docstring-code-line-length = 72  # Shorter lines in docstring code

# âœ… Compatibility vá»›i cÃ¡c tools khÃ¡c
[tool.ruff.lint.flake8-type-checking]
runtime-evaluated-base-classes = ["pydantic.BaseModel", "sqlalchemy.orm.DeclarativeBase"]

[tool.ruff.lint.flake8-pytest-style]
fixture-parentheses = false
mark-parentheses = false


[tool.ruff.lint.pyupgrade]
# âœ… Theo ká»‹p vá»›i cÃº phÃ¡p Python hiá»‡n Ä‘áº¡i
keep-runtime-typing = false  # Remove `from __future__ import annotations` when possible

# ğŸ“š Complete example - KhÃ´ng thiáº¿u gÃ¬
# ğŸ¯ Essential rules only - KhÃ´ng overwhelm
# ğŸ“ Clear comments - Giáº£i thÃ­ch má»i thá»©
# ğŸš€ Ready to use - Copy paste lÃ  cháº¡y Ä‘Æ°á»£c
# ğŸ“ˆ Scalable - Dá»… má»Ÿ rá»™ng sau nÃ y
